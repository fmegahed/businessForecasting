---
title: "ISA 444: Business Forecasting"
subtitle: "03 - Basic Tools and Goodness of Fit"
author: Fadel M. Megahed
date: 'Fall 2020'
output:
  beamer_presentation:
    number_sections: false
    toc: false
    slide_level: 3
    includes: 
      in_header: structure.txt
classoption: "aspectratio=169"
always_allow_html: yes
bibliography: refs.bib
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      verbose = FALSE,
                      progress = FALSE,
                      fig.align = "center",
                      fig.pos = 'p',
                      fig.width = 5.8,
                      fig.height= 2.9,
                      allowframebreaks = TRUE,
                      fig.margin=TRUE,
                      kable.force.latex = TRUE,
                      cache = TRUE)
options(kableExtra.latex.load_packages = FALSE)
pacman::p_load(kableExtra, tidyverse, xtable)
```

# Preface


### Quick Refresher based on Last Class

\begin{block}{\textbf{Main Learning Outcomes}}
			$\quad$ \textcolor{darkgreen}{\large \checkboxFadel} \textbf{Describe course objectives \& structure.} \\
			$\quad$ \textcolor{darkgreen}{\large \checkboxFadel} \textbf{Describe what do we mean by \textcolor{miamired}{forecasting} and explain the \textcolor{miamired}{PIVASE} framework.} \\
			$\quad$ \textcolor{darkgreen}{\large \checkboxFadel} \textbf{Explain the differences between cross sectional, time series, and panel datasets.} \\
			$\quad$ \textcolor{darkgreen}{\large \checkboxFadel} \textbf{Identify and describe the basic components of a time series including trends, seasonal components, and cycles.}
\end{block}

### Non-Graded Activity

For the [U.S.'s Advance Retail Sales Dataset](https://fred.stlouisfed.org/series/RSCCASN), please read the data into R and answer the four questions on the [Non-Graded Assignment on Canvas](https://miamioh.instructure.com/courses/123532/quizzes/321070). You have 8 minutes to answer all four questions.

**Note that this non-graded activity has NO impact on your grade. Time limit is set so that we do not take a significant portion of class to answer these questions.**


### Learning Objectives for Today's Class

\begin{block}{\textbf{Main Learning Outcomes}}
  \begin{itemize}
			\item \textbf{Interpret seasonal plots.} \\
			\item \textbf{Use numerical summaries to describe a time series.} \\
			\item \textbf{Apply differencing to a time series.}
	\end{itemize}
\end{block}


# Plots for Time-Series and Cross Sectional Data

## Plots for Time-Series Data

### Recall: Time-Series Plot {.allowframebreaks}

```{r tsPlot}
if(require(pacman)==FALSE) install.packages("pacman")
pacman::p_load(tidyverse, lubridate)
retailSales = read.csv("https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1168&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=RSCCASN&scale=left&cosd=1992-01-01&coed=2020-07-01&line_color=%234572a7&link_values=false&line_style=solid&mark_type=none&mw=3&lw=2&ost=-99999&oet=99999&mma=0&fml=a&fq=Monthly&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=1&transformation=lin&vintage_date=2020-08-23&revision_date=2020-08-23&nd=1992-01-01")
retailSales$DATE = ymd(retailSales$DATE)

retailSales %>% ggplot(aes(x = DATE, y = RSCCASN)) +
  geom_line() +
  labs(x = "Date", y = "Retail Sales (Monthly)", 
       title = "A Time Series Plot of Retail Sales",
       caption = "Data from FRED") +
  theme_bw()
```

### Constructing a Seasonal Plot -- Will be Coded Live in Class

```{r seasonalPlot, echo=FALSE}
if(require(pacman)==FALSE) install.packages("pacman")
pacman::p_load(tidyverse, lubridate)
retailSales = read.csv("https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1168&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=RSCCASN&scale=left&cosd=1992-01-01&coed=2020-07-01&line_color=%234572a7&link_values=false&line_style=solid&mark_type=none&mw=3&lw=2&ost=-99999&oet=99999&mma=0&fml=a&fq=Monthly&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=1&transformation=lin&vintage_date=2020-08-23&revision_date=2020-08-23&nd=1992-01-01")
retailSales$DATE = ymd(retailSales$DATE)
retailSales$MONTH = month(retailSales$DATE)
retailSales$YEAR = year(retailSales$DATE)

retailSales %>% filter(YEAR >= 2014 & YEAR < 2020) %>% 
  mutate(YEAR = as.factor(YEAR)) %>% 
  ggplot(aes(x = MONTH, y = RSCCASN, color = YEAR, group = YEAR)) +
  geom_line() +
  labs(x = "Month", y = "Retail Sales (Monthly)", 
       title = "A Seasonal Time Series Plot of Retail Sales",
       caption = "Data from FRED") + theme_bw() +
  scale_x_discrete(limits = factor(seq(1,12, 1)) ) +
  scale_color_brewer(type = "seq", palette = "Blues")
```

### An Evaluation of your Ability to Extend the Analysis [1]

- In 2-3 minutes, I would like to reproduce and extend the analysis from the previous slide to the Not Seasonally Adjusted GDP data from FRED (click [here to access data](https://fred.stlouisfed.org/series/NA000334Q)).  

- Your output should be similar to what is shown in the following slide.  

- This will **NOT** be graded, but it will force you to ask me questions if you are not able to get a graph similar to the one in the next slide \smiley{}.


### An Evaluation of your Ability to Extend the Analysis [2]

```{r gdp, echo=FALSE}
gdp = read.csv("https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1168&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=NA000334Q&scale=left&cosd=1947-01-01&coed=2020-04-01&line_color=%234572a7&link_values=false&line_style=solid&mark_type=none&mw=3&lw=2&ost=-99999&oet=99999&mma=0&fml=a&fq=Quarterly&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=1&transformation=lin&vintage_date=2020-08-23&revision_date=2020-08-23&nd=1947-01-01")
gdp$DATE = ymd(gdp$DATE)
gdp$QUARTER = quarter(gdp$DATE)
gdp$YEAR = year(gdp$DATE)

gdp %>% filter(YEAR >= 2015) %>% 
  mutate(YEAR = as.factor(YEAR)) %>% 
  ggplot(aes(x = QUARTER, y = NA000334Q, color = YEAR, group = YEAR)) +
  geom_line() +
  labs(x = "Quarter", y = "GDP (Quarterly)", 
       title = "A Seasonal Time Series Plot of GDP (NA000334Q)",
       caption = "Data from FRED") + theme_bw() +
  scale_x_discrete(limits = factor(seq(1,4, 1)) ) +
  scale_color_brewer(type = "seq", palette = "Blues")
```

### A Time Series Plot of GDP, color coded by Year {.allowframebreaks}

```{r gdp2}
gdp %>% filter(YEAR >= 2013) %>% 
    mutate(YEAR = as.factor(YEAR)) %>% 
    ggplot(aes(x = DATE, y = NA000334Q, color = YEAR)) +
    geom_line() +
    labs(x = "Date", y = "GDP (Quarterly)", 
         title = "A Seasonal, Colored by Year, Time Series Plot of GDP",
         subtitle = "See discussion in book pertaining to Fig. 2.3B",
         caption = "Data from FRED") + theme_bw() + scale_x_date() + 
    scale_color_brewer(type = "qual", palette = "Dark2") + geom_point()
```

## Plots for Cross Sectional Data


### Scatterplots [1]

- **Scatterplots** are frequently used to visualize the correlation between two continuous variables. 

- In this Example, we will be using the [German_Forecast Data](https://www.wessexlearning.org/pobf2e/index.html). The file can be downloaded to your working directory, using the `download.file()` from base R.  

- Note that the data is an xlsx file, which would require us to use the `read_excel()` from the [readxl package](https://readxl.tidyverse.org/). 

- We will remake the plot of GDP vs Govsurp (Figure 2.4 in our textbook) using R. As noted in the chapter, the figure was created using Minitab for the book.  

- The plot using the `ggplot()` is shown in the next slide. We will recreate it in class.


### Scatterplots [2]

```{r germanForecastScatter, echo=FALSE}
if(require(pacman)==FALSE) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, readxl)
download.file("https://www.wessexlearning.org/pobf2e/dsa/German_forecasts.xlsx",
              destfile = "Data/German_forecasts.xlsx", mode = "wb")
dfGerman = read_excel("Data/German_forecasts.xlsx")
dfGerman %>% ggplot(aes(x = Govsurp, y = GDP)) +
  geom_point() + 
  labs(title = "Scatterplot of GDP vs. Government Spending",
       caption = "Data from Muller-Droge et al. (2016)") + theme_bw()
```

### Scatterplot Matrix / Generalized Pairs Plots [1]

- Extending scatterplots for when we have more than two variables.\footnotemark  

- Can be easily created in R using the ``ggpairs()`` from the [GGally package](https://ggobi.github.io/ggally/articles/ggpairs.html). 


\footnotetext{John W Emerson, Walton A Green, Barret Schloerke, Jason Crowley, Dianne Cook, Heike Hofmann, Hadley Wickham.
The Generalized Pairs Plot.
Journal of Computational and Graphical Statistics, vol. 22, no. 1, pp. 79â€“91, 2012. \href{http://vita.had.co.nz/papers/gpp.pdf}{Click here to access paper}.}


### Scatterplot Matrix / Generalized Pairs Plots [2]

```{r scpMatrix, echo = FALSE}
pacman::p_load(tidyverse, GGally)
dfGerman %>% # object created from the example in the previous slide
  ggpairs(columns = c('GDP', 'GFCF', 'Govsurp', 'Unemp')) + 
  labs(title = "Matrix Plot of GDP, GFCF, Govsurp & Unemp",
       caption = "Data from Muller-Droge et al. (2016)") + theme_bw()
```


# Summarizing the Data, Correlation & Transformations

## Summarizing the Data

### Measures of Average
**Mean:** Given a set of $n$ values $Y_1, \, Y_2, \, \dots, \, Y_n$, the arithmetic mean can be computed as:

\begin{equation}
\bar{Y} = \frac{Y_1 + Y_2 + \dots + Y_n}{n} = \frac{1}{n}\sum_{i=1}^{i=n}Y_i.
\end{equation}

**Order Statistics:**
Given a set of $n$ values $Y_1, \, Y_2, \, \dots, \, Y_n$, we place them in an ascending order to define the order statistics, written as $Y_{(1)}, \, Y_{(2)}, \, \dots, \, Y_{(n)}.$

**Median:**  

  - If $n$ is odd, $n = 2m + 1$ and the median is $Y_{(m+1)}$.   
  - If $n$ is even, $n = 2m$ and the median is the average of the two middle numbers, i.e.,  $\frac{1}{2}[Y_{(m)} + Y_{(m+1)}]$.


### Measures of Variation

The **range** denotes the difference between the largest and smallest value in a sample:  
\begin{equation}
\text{Range} = Y_{(n)} - Y_{(1)}.
\end{equation}

The **deviation** is defined as the difference between a given observation $Y_i$ and the mean $\bar{Y}$.

The **mean absolute deviation (MAD)** is the average deviations about the mean, irrespective of their sign:
\begin{equation}
\text{MAD} = \frac{\sum_{i=1}^{i=n}|d_i|}{n}.
\end{equation}

The **variance** is the average of the squared deviations around the mean:  
\begin{equation}
S^2 = \frac{\sum_{i=1}^{i=n}d_i^2}{n-1}.
\end{equation}


### Applications of Measures of Average/Variance: MAD Function {.allowframebreaks}

- The `mad()` in R is used for computing the median absolute deviation and **Not** the mean absolute deviation. This can be easily checked using `?mad()` in your R console.  

- Thus, we will have to create our custom R function, `MAD()`, which we will define as follows: 
```{r MAD}
MAD = function(x){
  return( mean( abs(x-mean(x)) ) )
  }
```

- Now, let us make sure that this formula works as expected by testing it on the vector `x = c(1, 2, 3)` and comparing it with manually computing the MAD.


### Applications of Measures of Average/Variance: $^DJI {.allowframebreaks}
- Let us examine the stock prices for the [Dow Jones Industrial Average Index](https://finance.yahoo.com/quote/%5EDJI/) from March 23, 2020 up to and including August 21, 2020. 

- Let us compute the aforementioned measures, on the adjusted closing price, using the following two approaches: (a) averages **across** all months, and (b) averages **by/within** month. The printout for those two methods are shown in the tables below.

```{r dji, echo= FALSE, results='asis'}
if(require(pacman)==FALSE) install.packages("pacman")
pacman::p_load(tidyquant, lubridate, magrittr)
dowJonesIndex = tq_get("^DJI", from = "2020-03-23", to = "2020-08-22") %>% 
  select(symbol, date, adjusted)
dowJonesIndex$month = month(dowJonesIndex$date)
dowJonesIndex %>% summarise(meanACP = mean(adjusted),
                            medianACP = median(adjusted),
                            madACP = MAD(adjusted),
                            varACP = var(adjusted),
                            sdACP = sd(adjusted) ) -> djiSummary

print(xtable(djiSummary, align = c(rep('c', 6))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)

dowJonesIndex$month %>% factor(labels = c('March','April','May','June', 'July', 'August')) -> dowJonesIndex$month
dowJonesIndex %>% group_by(month) %>% summarise(meanACP = mean(adjusted),
                            medianACP = median(adjusted),
                            madACP = MAD(adjusted),
                            varACP = var(adjusted),
                            sdACP = sd(adjusted) ) -> djiSummary

print(xtable(djiSummary, align = c(rep('c', 7))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)
```

## Correlation

### The Pearson Correlation Coefficient

- **Correlation:** measures the strength of the **linear relationship** between two
quantitative variables.

- It can be computed using the `cor()` from base R. Mathematically speaking, the pearson correlation coefficient, $r$, can be computed as

\begin{equation}
  r = \frac{\sum_{i=1}^{n} (X_i - \bar{X})(Y_i - \bar{Y})}{\sqrt{\sum_{i=1}^{n}(X_i - \bar{X})^2 \sum_{i=1}^{n}(Y_i - \bar{Y})^2}}
\end{equation}


- Do **not** use the Pearson Correlation coefficient if both variables are not quantitative. Instead, refer to the `mixed.cor()` from the [psch package](https://personality-project.org/r/psych/help/mixed.cor.html) to compute the correlations for mixtures of continuous, polytomous, and/or dichotomous variables.

- You should supplement any descriptive summaries with visualizations to ensure that you are able to interpret the computations correctly.


### A Synthetic Example: The Anscombe Dataset [1]

**In a seminal paper, Anscombe stated:**\footnotemark *Few of us escape being indoctrinated with these notions* 

- *numerical calculations are exact, but graphs are rough;*  
- *for any particular kind of statistical data there is just one set of calculations constituting a correct statistical analysis;*  
- *performing intricate calculations is virtuous, whereas actually looking at the data is cheating.*

**He proceeded by stating that** *a computer should make both calculations and graphs. Both sorts of output should be studied; each will contribute to understanding.*  

**Now, let us consider his four datasets, each consisting of eleven (x,y) pairs.**

\footnotetext{Anscombe, Francis J. 1973. ``Graphs in Statistical Analysis." \textit{The American Statistician} 27 (1): 17â€“21. (\href{https://www.sjsu.edu/faculty/gerstman/StatPrimer/anscombe1973.pdf}{Click here to access the full paper}).}

### A Synthetic Example: The Anscombe Dataset [2]
```{r anscombe2, echo=FALSE, results="asis"}
print(xtable(anscombe, align = c(rep('r', 9))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)
```

### A Synthetic Example: The Anscombe Dataset [3]
```{r anscombe3, echo = FALSE, results='asis'}
pacman::p_load(Tmisc) # same data but in 3 columns
df = quartet %>% group_by(set) %>% 
  summarise(x.mean = mean(x), x.sd = sd(x),
            y.mean = mean(y), y.sd = sd(y),
            corr = cor(x, y))
print(xtable(df, align = c(rep('c', 7))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)
```


### A Synthetic Example: The Anscombe Dataset [4]
```{r anscombe4, results='asis', echo=FALSE}
ggplot(quartet, aes(x, y)) + geom_point() + 
  geom_smooth(method = lm, se = FALSE) + facet_wrap(~set) + theme_bw()
```


### Anscombe-Like Mistakes in Research and Practice
In my estimation, Figure 8c represents an example where regression should not have been performed\footnotemark. 

\vspace{-\baselineskip}

\centering \href{https://www.jneurosci.org/content/32/11/3791/tab-figures-data}{\includegraphics[width=\textwidth, height=0.6\textheight, keepaspectratio,frame]{Figures/F8Large.jpg}}

\footnotetext{Cai, Xinying, and Camillo Padoa-Schioppa. 2012. ``Neuronal Encoding of Subjective Value in Dorsal and Ventral Anterior Cingulate Cortex.'' \textit{Journal of Neuroscience} 32(11):3791â€“3808.}


## Transformations

### First Differences {.allowframebreaks}

The change in the time series from one period to the next is known as the (first) difference. It can be computed as follows:
\begin{equation}
DY_t = Y_t - Y_{t-1}
\end{equation}

```{r djIndexDiff}
dowJonesIndex = tq_get("^DJI", from = "2020-08-17", to = "2020-08-22") %>% 
  select(symbol, date, adjusted)
dowJonesIndex$`Yt-1` = lag(dowJonesIndex$adjusted)
dowJonesIndex$DYt = dowJonesIndex$adjusted - dowJonesIndex$`Yt-1`
```

```{r djIndexDiff2, results="asis", echo=FALSE}
print(xtable(dowJonesIndex, align = c(rep('c', 6))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)
```

Note that the differences can be computed in one step using the function `diff()` from base R as follows.

```{r djIndexDiff3}
dowJonesIndex = tq_get("^DJI", from = "2020-08-17", to = "2020-08-22") %>% 
  select(symbol, date, adjusted)
dowJonesIndex$DYt = c(NA, diff(dowJonesIndex$adjusted))
```

```{r djIndexDiff4, results="asis", echo=FALSE}
print(xtable(dowJonesIndex, align = c(rep('c', 5))), comment = FALSE, size = '\\scriptsize', include.rownames=FALSE)

```



# Recap

### Summary of Main Points

\begin{block}{\textbf{Main Learning Outcomes}}
  \begin{itemize}
			\item \textbf{Interpret seasonal plots.} \\
			\item \textbf{Use numerical summaries to describe a time series.} \\
			\item \textbf{Apply differencing to a time series.}
	\end{itemize}
\end{block}


### Things to Do

 - Thoroughly read Chapter 2 of our book. We covered up to the beginning of Section 2.6.1).  
 
 - Go through the slides, examples and make sure you have a good understanding of what we have covered. 
 
 - Complete the graded assignment for more details.
 
 - If you are interested in additional practice problems, please consider the following problems from your textbook.  
   - Exercise 2.4  
   - Exercise 2.7
   
### Graded Assignment 03: Evaluating your Retention/Focus

Please go to \href{https://miamioh.instructure.com/courses/123532/quizzes/321128}{Canvas (click here)} and answer the two questions. **Due August 27, 2020 [11:59 PM,
Ohio local time].** 

**What/Why/Prep?** The purpose of this assignment is to evaluate your understanding and retention of the material covered up to the end of Class 03. In order to prepare for this, you should have either actively attended class and/or watched the recording from WebEx. Furthermore, you should have thoroughly read up to the begining of Section 2.6.1 from your textbook.

**General Guidelines:**  

\vspace{-0.5\baselineskip}

  - Individual assignment.  
  - This is **NOT** a timed assignment (i.e. once you start the assignment you will have 25 minutes to complete 4 questions). If the concepts we covered are well-understood, this should take $\le 10$ minutes. 
  - Proctorio is NOT required for this assignment.  
  - You will need to have R installed (or accessible through the \href{https://virtualpc.fsb.miamioh.edu/RDWeb/Pages/en-US/default.aspx}{Remote Desktop})

---

\maketitle